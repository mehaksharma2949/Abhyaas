import { Plugin } from 'vite';

/**
 * 类型定义模块
 *
 * 设计思路：
 * 1. 使用 TypeScript 接口定义，提供类型安全
 * 2. 详细的 JSDoc 注释，提供 IDE 智能提示
 * 3. 合理的默认值设计，降低使用门槛
 */
/**
 * 插件配置选项
 *
 * 设计原则：
 * - 合理的默认值，开箱即用
 * - 渐进式配置，按需定制
 * - 清晰的命名，自解释性强
 */
interface ComponentTaggerOptions {
    /**
     * 是否启用插件
     * @default true
     */
    enabled?: boolean;
    /**
     * 是否在生产环境中启用
     * @default false
     */
    enableInProduction?: boolean;
    /**
     * 要排除的文件路径模式
     * @default ['node_modules']
     */
    exclude?: string[];
    /**
     * 要包含的文件扩展名
     * @default ['.jsx', '.tsx']
     */
    extensions?: string[];
    /**
     * 数据属性前缀
     * @default 'data-devv'
     */
    prefix?: string;
    /**
     * 是否添加传统属性（兼容旧版本）
     * @default true
     */
    includeLegacyAttributes?: boolean;
}

/**
 * Vite Plugin - Component Tagger
 *
 * 功能目标：
 * 1. 为所有 JSX/TSX 元素自动添加调试标记属性（data-devv-id, data-devv-name）
 * 2. 标记包含元素的精确位置信息（文件路径:行号:列号）
 * 3. 智能排除不需要标记的元素（Fragment, Three.js组件等）
 * 4. 支持生产环境自动禁用（通过 IS_PROD 环境变量）
 *
 * 使用场景：
 * - 开发调试时快速定位组件源码
 * - 自动化测试时精确选择元素
 * - 代码分析和组件追踪
 *
 * 设计思路：
 * 1. 使用 Vite 插件系统，在构建时拦截和修改源码
 * 2. 通过 AST 解析准确识别 JSX 结构，避免正则误匹配
 * 3. 使用 MagicString 高效修改代码，保持源码格式
 * 4. 两次遍历 AST：第一次收集需要排除的组件，第二次添加标记
 * 5. 环境变量控制，生产环境零成本
 */

/**
 * 插件主函数
 * @param options 用户配置选项
 * @returns Vite 插件对象
 */
declare function componentTagger(options?: ComponentTaggerOptions): Plugin;

export { type ComponentTaggerOptions, componentTagger, componentTagger as default };
